// Script pour crÃ©er la table CMS content_items
const { createClient } = require('@supabase/supabase-js');
const fs = require('fs');
const path = require('path');

// Configuration Supabase
const supabaseUrl = 'http://localhost:54321';
const supabase = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU';

const supabase = createClient(supabaseUrl, supabase);

async function setupCMSTable() { console.log('ðŸš€ Configuration de la table CMS...'); try { // CrÃ©er la table content_items const createTableSQL = ` -- CrÃ©er la table content_items CREATE TABLE IF NOT EXISTS content_items ( id UUID DEFAULT gen_random_uuid() PRIMARY , VARCHAR(255) UNIQUE NOT NULL, title VARCHAR(500) NOT NULL, content TEXT NOT NULL, type VARCHAR(50) NOT NULL CHECK (type IN ('text', 'title', 'description', 'button', 'link', 'image', 'video', 'html')), page VARCHAR(100) NOT NULL, section VARCHAR(100) NOT NULL, metadata JSONB DEFAULT '{}', is_published BOOLEAN DEFAULT false, version INTEGER DEFAULT 1, tags TEXT[] DEFAULT '{}', seo_title VARCHAR(255), seo_description TEXT, seo_words TEXT[], created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(), updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(), created_by UUID, updated_by UUID ); -- CrÃ©er les index pour amÃ©liorer les performances CREATE INDEX IF NOT EXISTS idx_content_items_ ON content_items(); CREATE INDEX IF NOT EXISTS idx_content_items_page ON content_items(page); CREATE INDEX IF NOT EXISTS idx_content_items_type ON content_items(type); CREATE INDEX IF NOT EXISTS idx_content_items_published ON content_items(is_published); CREATE INDEX IF NOT EXISTS idx_content_items_updated_at ON content_items(updated_at DESC); -- Fonction pour mettre Ã  jour automatiquement updated_at CREATE OR REPLACE FUNCTION update_updated_at_column() RETURNS TRIGGER AS $$ BEGIN NEW.updated_at = NOW(); RETURN NEW; END; $$ language 'plpgsql'; -- Trigger pour updated_at DROP TRIGGER IF EXISTS update_content_items_updated_at ON content_items; CREATE TRIGGER update_content_items_updated_at BEFORE UPDATE ON content_items FOR EACH ROW EXECUTE FUNCTION update_updated_at_column(); -- Activer RLS (Row Level Security) ALTER TABLE content_items ENABLE ROW LEVEL SECURITY; -- Politique pour la lecture publique du contenu publiÃ© DROP POLICY IF EXISTS "Public can read published content" ON content_items; CREATE POLICY "Public can read published content" ON content_items FOR SELECT USING (is_published = true); -- Politique pour les istrateurs DROP POLICY IF EXISTS s can manage all content" ON content_items; CREATE POLICY s can manage all content" ON content_items FOR ALL USING (true); `; console.log('ðŸ“ CrÃ©ation de la table content_items...'); const { error: createError } = await supabase.rpc('exec_sql', { sql: createTableSQL }); if (createError) { console.error('âŒ Erreur lors de la crÃ©ation de la table:', createError); // Essayer une approche alternative console.log('ðŸ”„ Tentative alternative...'); // CrÃ©er la table directement const { error: directError } = await supabase .from('content_items') .select('id') .limit(1); if (directError && directError.code === '42P01') { console.log('âš ï¸ La table n\'existe pas, crÃ©ation manuelle nÃ©cessaire.'); console.log('ðŸ“‹ Veuillez exÃ©cuter le script SQL suivant dans l\'interface Supabase:'); console.log('\n' + createTableSQL + '\n'); return false; } } // InsÃ©rer les donnÃ©es de console.log('ðŸ“Š Insertion des donnÃ©es de ...'); const Data = [ { : 'hero.title', title: 'Titre Principal', content: 'Bienvenue chez OMIAM - Saveurs Authentiques du Maroc', type: 'title', page: 'homepage', section: 'hero', is_published: true, metadata: { level: 'h1', style: 'hero' } }, { : 'hero.description', title: 'Description Hero', content: 'DÃ©couvrez nos plats traditionnels marocains prÃ©parÃ©s avec amour et des ingrÃ©dients frais.', type: 'description', page: 'homepage', section: 'hero', is_published: true, metadata: { format: 'paragraph' } }, { : 'hero.cta', title: 'Bouton CTA', content: 'Commander maintenant', type: 'button', page: 'homepage', section: 'hero', is_published: true, metadata: { url: '/menu', style: 'primary' } }, { : 'about.title', title: 'Titre Ã€ propos', content: 'Notre Histoire', type: 'title', page: 'homepage', section: 'about', is_published: true, metadata: { level: 'h2' } }, { : 'about.content', title: 'Contenu Ã€ propos', content: 'OMIAM est nÃ© de la passion pour la cuisine marocaine authentique. Depuis 2020, nous servons des plats traditionnels dans une ambiance chaleureuse.', type: 'text', page: 'homepage', section: 'about', is_published: true, metadata: { format: 'paragraph' } }, { : 'contact.phone', title: 'TÃ©lÃ©phone', content: '+33 1 23 45 67 89', type: 'text', page: 'contact', section: 'info', is_published: true, metadata: { format: 'phone', icon: 'phone' } }, { : 'contact.email', title: 'Email', content: 'contact@omiam.fr', type: 'text', page: 'contact', section: 'info', is_published: true, metadata: { format: 'email', icon: 'mail' } }, { : 'contact.address', title: 'Adresse', content: '123 Rue de la Paix, 75001 Paris', type: 'text', page: 'contact', section: 'info', is_published: true, metadata: { format: 'address', icon: 'map-pin' } }, { : 'menu.featured.title', title: 'Nos SpÃ©cialitÃ©s', content: 'DÃ©couvrez nos plats signature', type: 'title', page: 'menu', section: 'featured', is_published: true, metadata: { level: 'h2', style: 'featured' } }, { : 'footer.copyright', title: 'Copyright', content: 'Â© 2024 OMIAM. Tous droits rÃ©servÃ©s.', type: 'text', page: 'global', section: 'footer', is_published: true, metadata: { position: 'bottom' } } ]; // InsÃ©rer les donnÃ©es une par une pour Ã©viter les conflits for (const item of Data) { const { error: insertError } = await supabase .from('content_items') .upsert(item, { onConflict:  }); if (insertError) { console.warn(`âš ï¸ Erreur lors de l'insertion de ${item.}:`, insertError.message); } else { console.log(`âœ… InsÃ©rÃ©: ${item.}`); } } console.log('ðŸŽ‰ Configuration CMS terminÃ©e avec succÃ¨s!'); console.log('ðŸŒ Vous pouvez maintenant accÃ©der Ã  l\'interface CMS sur: http://localhost:30020/); return true; } catch (error) { console.error('âŒ Erreur lors de la configuration CMS:', error); return false; }
}

// ExÃ©cuter le script
setupCMSTable().then(success => { if (success) { console.log('âœ… Script terminÃ© avec succÃ¨s'); } else { console.log('âŒ Script terminÃ© avec des erreurs'); } process.exit(success ? 0 : 1);
}).catch(error => { console.error('ðŸ’¥ Erreur fatale:', error); process.exit(1);
});