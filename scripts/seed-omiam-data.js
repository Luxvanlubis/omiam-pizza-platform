"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.seedOmiamData = seedOmiamData;
const client_1 = require("@prisma/client");
const prisma = new client_1.PrismaClient();
// DonnÃ©es complÃ¨tes O'Miam
const omiamData = { business: { name: "O'Miam", address: "12 Rue des Ponts Saint-Michel, 22200 Guingamp, France", phone: "+33 2 96 14 61 53", opened: "2021-01", signature: ["four Ã  bois", "produits frais", "convivialitÃ©"] }, channels: { deliveroo: "https://deliveroo.fr/en/menu/guingamp/guingamp-centre/omiam-guingamp", coopcycle_breizh_velo: "https://breizhvelo.coopcycle.org/fr/restaurant/9-o-miam", facebook: "https://www.facebook.com/OMiamGuingamp/" }, menu: { pizzas: [ { "name": "Savoyarde", "base": "crÃ¨me", "ingredients": ["mozzarella", "oignons", "lardons", "pomme de terre", "raclette"], "price_eur": 15.00 }, { "name": "Rustique", "base": "tomate+crÃ¨me", "ingredients": ["mozzarella", "saucisse fumÃ©e", "raclette", "pommes de terre"], "price_eur": 15.00 }, { "name": "Campagnarde", "base": "tomate", "ingredients": ["champignons", "mozzarella", "oignons", "lardon", "jambon"], "price_eur": 13.00 }, { "name": "Calzone Regina", "base": "crÃ¨me", "ingredients": ["champignons", "jambon", "mozzarella"], "price_eur": 12.00 }, { "name": "Bombay", "base": "crÃ¨me+miel", "ingredients": ["mozzarella", "oignons", "poivron", "poulet curry"], "price_eur": 14.00 }, { "name": "NorvÃ©gienne", "base": "tomate+crÃ¨me", "ingredients": ["mozzarella", "persillade", "saumon fumÃ©"], "price_eur": 15.00 }, { "name": "Louisiane", "base": "barbecue", "ingredients": ["mozzarella", "lardons", "poulet", "bÅ“uf", "poivrons", "curry"], "price_eur": 14.00 }, { "name": "Capra", "base": "crÃ¨me+miel", "ingredients": ["mozzarella", "chÃ¨vre", "tomate fraÃ®che"], "price_eur": 13.00 }, { "name": "Royale", "base": "tomate", "ingredients": ["mozzarella", "jambon", "champignons"], "price_eur": 12.00 }, { "name": "Margarita", "base": "tomate", "ingredients": ["mozzarella"], "price_eur": 10.00 }, { "name": "La Parma Roquette", "base": "tomate", "ingredients": ["mozzarella", "basilic", "jambon cru", "tomates cerises", "roquette", "parmesan"], "price_eur": 15.00 }, { "name": "KÃ©bab", "base": "tomate+crÃ¨me", "ingredients": ["mozzarella", "oignons", "kebab"], "price_eur": 14.00 }, { "name": "4 Fromages", "base": "tomate", "ingredients": ["mozzarella", "chÃ¨vre", "raclette", "gorgonzola"], "price_eur": 15.00 }, { "name": "Tona", "base": "tomate", "ingredients": ["mozzarella", "olives", "poivrons", "basilic", "thon"], "price_eur": 13.00 }, { "name": "Napolitaine", "base": "tomate", "ingredients": ["mozzarella", "anchois", "cÃ¢pre"], "price_eur": 12.00 }, { "name": "Flamenkuche", "base": "crÃ¨me", "ingredients": ["mozzarella", "oignons", "lardons"], "price_eur": 12.00 }, { "name": "Orientale", "base": "tomate", "ingredients": ["mozzarella", "pomme de terre", "merguez", "bÅ“uf", "poivrons"], "price_eur": 14.00 }, { "name": "Bolognaise", "base": "tomate", "ingredients": ["mozzarella", "oignons", "bÅ“uf hachÃ©"], "price_eur": 14.00 }, { "name": "Pepperonni", "base": "tomate", "ingredients": ["mozzarella", "pepperonni"], "price_eur": 13.00 }, { "name": "Italienne", "base": "tomate", "ingredients": ["bille de mozzarella", "basilic frais", "tomate cerise"], "price_eur": 12.00 }, { "name": "VÃ©gÃ©tarienne", "base": "tomate", "ingredients": ["mozzarella", "aubergine", "cÅ“ur d'artichaut", "poivrons", "huile de basilic"], "price_eur": 13.00 }, { "name": "Cactus", "base": "tomate", "ingredients": ["mozzarella", "chorizo", "merguez", "bÅ“uf", "poivrons"], "price_eur": 14.00 }, { "name": "Los Angeles", "base": "barbecue", "ingredients": ["mozzarella", "oignons", "bÅ“uf", "pepperoni"], "price_eur": 14.00 } ], desserts: [ { "name": "Pizza Nutella", "price_eur": 8.50 } ], softs: [ { "name": "Coca-Cola 1,25L", "price_eur": 3.50 }, { "name": "Oasis Tropical 2L", "price_eur": 3.50 }, { "name": "Coca-Cola 33cL", "price_eur": 2.00 }, { "name": "Coca Cherry 33cL", "price_eur": 2.00 }, { "name": "Fanta Orange 33cL", "price_eur": 2.00 }, { "name": "Fanta Passion 33cL", "price_eur": 2.00 }, { "name": "Fanta Mangue Fruit du Dragon 33cL", "price_eur": 2.00 }, { "name": "Ice Tea 33cL", "price_eur": 2.00 }, { "name": "Oasis Tropical 33cL", "price_eur": 2.00 }, { "name": "Bouteille d'eau 50cL", "price_eur": 1.00 } ], beers: [ { "name": "Heineken 33cL", "price_eur": 3.00 }, { "name": "Desperados 33cL", "price_eur": 3.50 } ], specials: [ { "name": "Couscous (vendredi-dimanche)", "price_eur": null, "note": "annoncÃ© presse locale" }, { "name": "Panier Too Good To Go", "price_eur": 3.99, "value_hint_eur": 12.00 } ] }, reputation: { rating_restaurantguru: 4.4, highlights: ["pÃ¢te au feu de bois", "produits frais", "accueil/rapiditÃ©"] }, media_pages: [ "https://deliveroo.fr/en/menu/guingamp/guingamp-centre/omiam-guingamp", "https://fr.restaurantguru.com/OMiam-Guingamp", "https://restaurantguru.com/OMiam-Guingamp/menu", "https://lacarte.menu/restaurants/guingamp/omiam-5", "https://www.facebook.com/OMiamGuingamp/" ]
};
async function seedOmiamData() { console.log('ðŸ• DÃ©but du seed des donnÃ©es O\'Miam...'); try { // 1. CrÃ©er le restaurant O'Miam const restaurant = await prisma.restaurant.upsert({ where: { name: omiamData.business.name }, update: { address: omiamData.business.address, phone: omiamData.business.phone, signature: JSON.stringify(omiamData.business.signature), openedDate: new Date('2021-01-01'), rating: omiamData.reputation.rating_restaurantguru, highlights: JSON.stringify(omiamData.reputation.highlights) }, create: { name: omiamData.business.name, address: omiamData.business.address, phone: omiamData.business.phone, signature: JSON.stringify(omiamData.business.signature), openedDate: new Date('2021-01-01'), rating: omiamData.reputation.rating_restaurantguru, highlights: JSON.stringify(omiamData.reputation.highlights) } }); console.log(`âœ… Restaurant crÃ©Ã©: ${restaurant.name}`); // 2. CrÃ©er les canaux de distribution const channels = [ { name: 'deliveroo', url: omiamData.channels.deliveroo }, { name: 'coopcycle_breizh_velo', url: omiamData.channels.coopcycle_breizh_velo }, { name: 'facebook', url: omiamData.channels.facebook } ]; for (const channel of channels) { // VÃ©rifier si le canal existe dÃ©jÃ  const existingChannel = await prisma.restaurantChannel.findFirst({ where: { restaurantId: restaurant.id, name: channel.name } }); if (existingChannel) { // Mettre Ã  jour await prisma.restaurantChannel.update({ where: { id: existingChannel.id }, data: { url: channel.url } }); } else { // CrÃ©er await prisma.restaurantChannel.create({ data: { restaurantId: restaurant.id, name: channel.name, url: channel.url } }); } } console.log(`âœ… ${channels.length} canaux crÃ©Ã©s`); // 3. CrÃ©er les pages mÃ©dia const mediaPages = omiamData.media_pages.map((url, index) => ({ title: `Page mÃ©dia ${index + 1}`, url: url.replace(/`/g, ''), mediaType: url.includes('deliveroo') ? 'menu' : url.includes('facebook') ? 'social' : url.includes('restaurantguru') ? 'reviews' : 'gallery' })); for (const media of mediaPages) { await prisma.restaurantMedia.create({ data: { restaurantId: restaurant.id, ...media } }); } console.log(`âœ… ${mediaPages.length} pages mÃ©dia crÃ©Ã©es`); // 4. CrÃ©er les spÃ©ciaux for (const special of omiamData.menu.specials) { // VÃ©rifier si le spÃ©cial existe dÃ©jÃ  const existingSpecial = await prisma.restaurantSpecial.findFirst({ where: { restaurantId: restaurant.id, name: special.name } }); if (existingSpecial) { // Mettre Ã  jour await prisma.restaurantSpecial.update({ where: { id: existingSpecial.id }, data: { price: special.price_eur, valueHint: special.value_hint_eur || null, description: special.note || null } }); } else { // CrÃ©er await prisma.restaurantSpecial.create({ data: { restaurantId: restaurant.id, name: special.name, price: special.price_eur, valueHint: special.value_hint_eur || null, description: special.note || null } }); } } console.log(`âœ… ${omiamData.menu.specials.length} spÃ©ciaux crÃ©Ã©s`); // 5. CrÃ©er/Mettre Ã  jour les produits du menu let productCount = 0; // Pizzas for (const pizza of omiamData.menu.pizzas) { const description = `Base: ${pizza.base}. IngrÃ©dients: ${pizza.ingredients.join(', ')}`; await prisma.product.upsert({ where: { name: pizza.name }, update: { description, price: pizza.price_eur, category: 'Pizza', ingredients: JSON.stringify(pizza.ingredients) }, create: { name: pizza.name, description, price: pizza.price_eur, category: 'Pizza', ingredients: JSON.stringify(pizza.ingredients) } }); productCount++; } // Desserts for (const dessert of omiamData.menu.desserts) { await prisma.product.upsert({ where: { name: dessert.name }, update: { price: dessert.price_eur, category: 'Dessert' }, create: { name: dessert.name, price: dessert.price_eur, category: 'Dessert', ingredients: JSON.stringify([]) } }); productCount++; } // Boissons for (const soft of omiamData.menu.softs) { await prisma.product.upsert({ where: { name: soft.name }, update: { price: soft.price_eur, category: 'Boisson' }, create: { name: soft.name, price: soft.price_eur, category: 'Boisson', ingredients: JSON.stringify([]) } }); productCount++; } // BiÃ¨res for (const beer of omiamData.menu.beers) { await prisma.product.upsert({ where: { name: beer.name }, update: { price: beer.price_eur, category: 'BiÃ¨re' }, create: { name: beer.name, price: beer.price_eur, category: 'BiÃ¨re', ingredients: JSON.stringify([]) } }); productCount++; } console.log(`âœ… ${productCount} produits crÃ©Ã©s/mis Ã  jour`); console.log('ðŸŽ‰ Seed des donnÃ©es O\'Miam terminÃ© avec succÃ¨s!'); console.log(`ðŸ“Š RÃ©sumÃ©:`); console.log(` - Restaurant: ${restaurant.name}`); console.log(` - Canaux: ${channels.length}`); console.log(` - Pages mÃ©dia: ${mediaPages.length}`); console.log(` - SpÃ©ciaux: ${omiamData.menu.specials.length}`); console.log(` - Produits: ${productCount}`); } catch (error) { console.error('âŒ Erreur lors du seed:', error); throw error; } finally { await prisma.$disconnect(); }
}
// ExÃ©cuter le seed si appelÃ© directement
if (require.main === module) { seedOmiamData() .catch((error) => { console.error(error); process.exit(1); });
}
